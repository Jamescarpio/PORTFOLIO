<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#050b18" />
<title>James Carpio | Ultra Futuristic Portfolio</title>

<style>
:root{
  --bg:#040914;
  --bg2:#020612;
  --neon:#4da3ff;
  --accent:#7f5cff;
  --text:#eaf2ff;
  --muted:rgba(234,242,255,.72);
  --glass:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.14);
  --shadow:rgba(77,163,255,.20);
  --radius:28px;
  --focus:rgba(77,163,255,.55);
}

*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  color:var(--text);
  background:linear-gradient(180deg,var(--bg),var(--bg2));
  overflow-x:hidden;
}

/* Accessibility + motion */
:focus-visible{outline:2px solid var(--focus); outline-offset:3px; border-radius:12px}
@media (prefers-reduced-motion: reduce){
  *{animation:none!important; transition:none!important; scroll-behavior:auto!important}
}

/* ====== Fixed 3D + Ambient ====== */
#bg3d{position:fixed;inset:0;z-index:-6;pointer-events:none}
#bg3d canvas{display:block;width:100%;height:100%}

.energy{
  position:fixed; inset:-40%;
  background:
    radial-gradient(circle at 20% 25%, rgba(77,163,255,.22), transparent 40%),
    radial-gradient(circle at 75% 55%, rgba(127,92,255,.22), transparent 46%),
    radial-gradient(circle at 45% 85%, rgba(77,163,255,.14), transparent 48%);
  filter:blur(10px) saturate(1.2);
  opacity:.85;
  animation:energyMove 18s linear infinite;
  pointer-events:none;
  z-index:-5;
}
@keyframes energyMove{
  0%{transform:translate(0,0) rotate(0deg)}
  50%{transform:translate(5%,3%) rotate(180deg)}
  100%{transform:translate(0,0) rotate(360deg)}
}
.grid{
  position:fixed; inset:0;
  background:radial-gradient(circle, rgba(255,255,255,.09) 1px, transparent 1px);
  background-size:48px 48px;
  opacity:.38;
  animation:gridFlow 60s linear infinite;
  pointer-events:none;
  z-index:-4;
}
@keyframes gridFlow{to{background-position:1200px 1200px}}
.vignette{
  position:fixed; inset:0;
  background:radial-gradient(circle at 50% 40%, transparent 45%, rgba(0,0,0,.62) 80%, rgba(0,0,0,.82));
  pointer-events:none;
  z-index:-3;
}

/* ====== Scroll-Snap Fullscreen ====== */
main{
  height:100vh;
  overflow:auto;
  scroll-snap-type:y mandatory;
  scroll-behavior:smooth;
}
.section{
  min-height:100vh;
  scroll-snap-align:start;
  scroll-snap-stop:always;
  display:grid;
  place-items:center;
  padding:96px 18px 70px;
  position:relative;
}
.container{
  width:min(1120px, 94vw);
  border-radius:var(--radius);
  background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.02));
  border:1px solid var(--border);
  backdrop-filter:blur(26px);
  box-shadow:0 0 160px rgba(77,163,255,.16);
  padding:46px;
  position:relative;
  overflow:hidden;
  transform:translateZ(0);
  transition:.35s cubic-bezier(.4,0,.2,1);
}
.container::before{
  content:"";
  position:absolute; inset:-40%;
  background:
    radial-gradient(circle at 30% 30%, rgba(77,163,255,.14), transparent 40%),
    radial-gradient(circle at 70% 65%, rgba(127,92,255,.14), transparent 44%);
  opacity:.35;
  filter:blur(10px);
  pointer-events:none;
}
.container:hover{transform:translateY(-10px)}

/* ====== HUD NAV ====== */
nav{
  position:fixed; top:14px; left:50%;
  transform:translateX(-50%);
  z-index:50;
  display:flex; gap:10px; align-items:center;
  padding:10px 12px;
  border-radius:999px;
  background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
  border:1px solid var(--border);
  backdrop-filter:blur(18px);
  box-shadow:0 0 90px rgba(77,163,255,.18);
}
nav .brand{
  display:flex; align-items:center; gap:10px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
}
nav .dot{
  width:10px;height:10px;border-radius:50%;
  background:rgba(77,163,255,.9);
  box-shadow:0 0 18px rgba(77,163,255,.65);
}
nav a{
  text-decoration:none; color:var(--text);
  font-size:.95rem;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid transparent;
  opacity:.9;
}
nav a:hover{
  border-color:rgba(77,163,255,.45);
  background:rgba(77,163,255,.08);
  opacity:1;
}
#adminPill{
  display:none;
  gap:8px;
  align-items:center;
  padding:6px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
}
#adminPill .tagmini{
  font-size:.82rem;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(77,163,255,.45);
  background:rgba(77,163,255,.08);
  color:var(--muted);
}
#adminPill button, #adminPill label{
  font-size:.85rem;
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  color:var(--text);
  cursor:pointer;
}
#adminPill button:hover, #adminPill label:hover{border-color:rgba(77,163,255,.5)}
#adminImport{display:none}

#progress{
  position:fixed; left:0; top:0;
  height:3px; width:0%;
  background:linear-gradient(90deg, rgba(77,163,255,.9), rgba(127,92,255,.9));
  box-shadow:0 0 18px rgba(77,163,255,.55);
  z-index:60;
}

/* ====== Hero ====== */
h1{
  font-size:3.6rem;
  letter-spacing:.6px;
  line-height:1.04;
}
h2{font-size:2.05rem; letter-spacing:.3px}
h3{font-size:1.1rem; letter-spacing:.2px}
.gradientText{
  background:linear-gradient(90deg, rgba(77,163,255,.95), rgba(127,92,255,.95), rgba(255,255,255,.92));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  filter:drop-shadow(0 0 26px rgba(77,163,255,.22));
}
.kicker{
  margin-top:12px;
  color:var(--muted);
  font-size:1.07rem;
  line-height:1.55;
}
.actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
.btn{
  display:inline-flex;align-items:center;gap:10px;
  padding:12px 16px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.18);
  color:var(--text);
  text-decoration:none;
  cursor:pointer;
  transition:.25s ease;
}
.btn:hover{
  transform:translateY(-2px);
  border-color:rgba(77,163,255,.5);
  box-shadow:0 0 40px rgba(77,163,255,.12);
}
.btn.primary{
  background:linear-gradient(135deg, rgba(77,163,255,.20), rgba(127,92,255,.14));
  border-color:rgba(77,163,255,.38);
}

.grid2{
  display:grid;
  grid-template-columns:1.15fr .85fr;
  gap:18px;
  margin-top:22px;
}
.card{
  border-radius:22px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  padding:18px;
  box-shadow:0 0 100px rgba(77,163,255,.12);
}
.pill{
  display:flex;justify-content:space-between;gap:14px;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  color:var(--muted);
  font-size:.95rem;
  margin-top:10px;
}
.pill b{color:var(--text); font-weight:650}

/* ====== Photo ====== */
#photoContainer{
  display:flex; flex-direction:column; align-items:center;
  gap:14px; margin-bottom:18px;
}
#profilePhoto{
  width:172px;height:172px;border-radius:50%;
  object-fit:cover;
  border:2px solid rgba(77,163,255,.75);
  box-shadow:0 0 34px rgba(77,163,255,.65), 0 0 110px rgba(77,163,255,.25);
  display:none;
}
#photoUploadLabel{
  display:none;
  padding:10px 16px;
  border-radius:999px;
  border:1px solid rgba(77,163,255,.65);
  background:rgba(77,163,255,.08);
  cursor:pointer;
}
#photoUpload{display:none}

/* ====== 3D Stage (embedded section UI) ====== */
.stage{
  margin-top:18px;
  height:640px;
  border-radius:var(--radius);
  border:1px solid rgba(255,255,255,.14);
  background:
    radial-gradient(1000px 600px at 50% 30%, rgba(77,163,255,.10), transparent 62%),
    radial-gradient(1100px 650px at 70% 65%, rgba(127,92,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,.26), rgba(0,0,0,.58));
  box-shadow:0 0 170px rgba(77,163,255,.14);
  position:relative;
  overflow:hidden;
}
.stageHUD{position:absolute; inset:0; pointer-events:none}
.stageHUD .scan{
  position:absolute; inset:0;
  background:linear-gradient(to bottom, transparent, rgba(255,255,255,.08), transparent);
  opacity:.15;
  animation:scan 5.0s linear infinite;
}
@keyframes scan{0%{transform:translateY(-55%)}100%{transform:translateY(55%)}}
.stageHUD .lines{
  position:absolute; inset:0;
  background:
    linear-gradient(to right, transparent, rgba(77,163,255,.35), transparent) 50% 18% / 86% 1px no-repeat,
    linear-gradient(to right, transparent, rgba(255,255,255,.18), transparent) 50% 50% / 92% 1px no-repeat,
    linear-gradient(to right, transparent, rgba(127,92,255,.28), transparent) 50% 82% / 88% 1px no-repeat;
  opacity:.55;
}
.badges{
  position:absolute; top:18px; left:18px;
  display:flex; flex-wrap:wrap; gap:10px;
  z-index:6;
}
.badge{
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(77,163,255,.55);
  background:rgba(77,163,255,.08);
  font-size:.9rem;
  color:var(--muted);
}
.badge b{color:var(--text)}
.scrollHint{
  position:absolute; right:18px; bottom:18px;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.22);
  font-size:.9rem;
  color:var(--muted);
  z-index:6;
}

/* ====== Skills / Projects ====== */
.tags{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.tag{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(77,163,255,.55);
  background:rgba(77,163,255,.08);
  color:var(--muted);
}

.projectsGrid{
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:14px;
  margin-top:16px;
}
.projectCard{
  border-radius:22px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  box-shadow:0 0 90px rgba(77,163,255,.10);
  overflow:hidden;
  transition:.30s cubic-bezier(.4,0,.2,1);
  position:relative;
}
.projectCard:hover{transform:translateY(-8px)}
.thumb{
  height:160px;
  background:#0b1730;
  border-bottom:1px solid rgba(255,255,255,.10);
  position:relative;
  overflow:hidden;
}
.thumb img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.1) contrast(1.05)}
.thumb::after{
  content:"";
  position:absolute; inset:-40%;
  background:radial-gradient(circle at 20% 30%, rgba(77,163,255,.16), transparent 40%);
  opacity:.45;
  filter:blur(12px);
  pointer-events:none;
}
.pBody{padding:16px}
.pTitle{font-weight:750}
.pMeta{margin-top:8px;color:var(--muted);font-size:.95rem;line-height:1.5}
.pBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.smallBtn{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  color:var(--text);
  cursor:pointer;
  text-decoration:none;
}
.smallBtn:hover{transform:translateY(-2px);border-color:rgba(77,163,255,.5)}

/* ====== Modal ====== */
#modal{
  position:fixed; inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:120;
  background:rgba(0,0,0,.62);
  backdrop-filter:blur(8px);
  padding:18px;
}
#modal.on{display:flex}
.modalBox{
  width:min(980px, 96vw);
  border-radius:26px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
  box-shadow:0 0 160px rgba(77,163,255,.18);
  overflow:hidden;
}
.modalTop{
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 16px;
  background:rgba(0,0,0,.22);
  border-bottom:1px solid rgba(255,255,255,.10);
}
.modalTop b{letter-spacing:.3px}
.modalClose{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  color:var(--text);
  cursor:pointer;
}
.modalClose:hover{border-color:rgba(77,163,255,.5)}
.modalContent{display:grid;grid-template-columns:1.1fr .9fr;gap:0}
.modalImg{min-height:320px;background:#0b1730;border-right:1px solid rgba(255,255,255,.10)}
.modalImg img{width:100%;height:100%;object-fit:cover;display:block}
.modalInfo{padding:18px}
.modalDesc{color:var(--muted);line-height:1.6;margin-top:10px}
.modalLinks{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.hr{height:1px;background:rgba(255,255,255,.10);margin:14px 0}

/* ====== Chat ====== */
#chatBtn{
  position:fixed; right:18px; bottom:18px;
  width:78px;height:78px;border-radius:50%;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(135deg, rgba(77,163,255,.22), rgba(127,92,255,.14));
  color:var(--text);
  font-size:28px;
  cursor:pointer;
  box-shadow:0 0 70px rgba(77,163,255,.38);
  z-index:110;
  transition:.25s ease;
}
#chatBtn:hover{transform:translateY(-4px) scale(1.02)}
#chatBox{
  position:fixed; right:18px; bottom:110px;
  width:420px; max-width:92vw;
  border-radius:24px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(135deg, rgba(10,26,51,.92), rgba(2,6,18,.94));
  box-shadow:0 0 110px rgba(77,163,255,.18);
  display:none;
  flex-direction:column;
  overflow:hidden;
  z-index:110;
}
#chatMessages{padding:16px;height:300px;overflow-y:auto}
.row{
  display:flex; gap:10px;
  padding:12px;
  border-top:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
}
#chatInput{
  flex:1;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:var(--text);
  outline:none;
}
.ctrlBtn{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(77,163,255,.10);
  color:var(--text);
  cursor:pointer;
}
.ctrlBtn:hover{transform:translateY(-2px)}
.msg-user{color:#6fb4ff;margin:8px 0}
.msg-ai{color:#b5d8ff;margin:8px 0}

/* ====== Editable ====== */
.editable[contenteditable="true"]{outline:1px dashed var(--neon);padding:6px;border-radius:10px}

/* ====== Responsive ====== */
@media (max-width:980px){
  h1{font-size:2.8rem}
  .grid2{grid-template-columns:1fr}
  .projectsGrid{grid-template-columns:1fr}
  .stage{height:720px}
  .modalContent{grid-template-columns:1fr}
  .modalImg{border-right:none;border-bottom:1px solid rgba(255,255,255,.10)}
}
</style>
</head>

<body>
<div id="progress"></div>
<div class="energy"></div>
<div class="grid"></div>
<div class="vignette"></div>
<div id="bg3d"></div>

<nav>
  <div class="brand" aria-label="Brand">
    <span class="dot" aria-hidden="true"></span>
    <span style="opacity:.92;font-weight:750">JC</span>
  </div>
  <a href="#home">Home</a>
  <a href="#system">System</a>
  <a href="#about">About</a>
  <a href="#skills">Skills</a>
  <a href="#projects">Projects</a>
  <a href="#contact">Contact</a>

  <!-- Admin quick tools (shows only when admin is ON) -->
  <div id="adminPill" aria-label="Admin tools">
    <span class="tagmini">ADMIN</span>
    <button id="exportBtn" type="button">‚¨á Export</button>
    <label for="adminImport">‚¨Ü Import</label>
    <input id="adminImport" type="file" accept="application/json">
    <button id="resetBtn" type="button">üßπ Reset</button>
  </div>
</nav>

<main id="scroller">
  <!-- HOME -->
  <section class="section" id="home">
    <div class="container">
      <div id="photoContainer">
        <img id="profilePhoto" alt="Profile Photo">
        <label id="photoUploadLabel">
          Upload Photo
          <input type="file" id="photoUpload" accept="image/*">
        </label>
      </div>

      <h1 class="editable" data-key="name"><span class="gradientText">James Carpio</span></h1>
      <p class="kicker editable" data-key="hero-kicker">
        I build premium, future-ready systems by blending <b>Generative AI</b>, <b>Engineering</b>, and <b>Business Communication</b> ‚Äî
        turning ideas into outcomes.
      </p>

      <div class="actions">
        <a class="btn primary" href="#projects">üöÄ View Projects</a>
        <a class="btn" href="#contact">üì© Contact</a>
        <button class="btn" id="toggleAdmin" type="button">üõ† Admin</button>
      </div>

      <div class="grid2">
        <div class="card">
          <h3>‚ö° Core Focus</h3>
          <div class="pill editable" data-key="pill-1"><span>Domain</span><b>AI + Engineering</b></div>
          <div class="pill editable" data-key="pill-2"><span>Style</span><b>Futuristic ‚Ä¢ Clean ‚Ä¢ High Impact</b></div>
          <div class="pill editable" data-key="pill-3"><span>Goal</span><b>Build systems people love</b></div>
        </div>
        <div class="card">
          <h3>üîó Identity</h3>
          <div class="pill editable" data-key="pill-4"><span>Email</span><b>james.carpio@email.com</b></div>
          <div class="pill editable" data-key="pill-5"><span>LinkedIn</span><b>linkedin.com/in/james-carpio-b338b6337</b></div>
          <div class="pill editable" data-key="pill-6"><span>Location</span><b>Philippines</b></div>
        </div>
      </div>

      <p style="margin-top:14px;color:var(--muted);font-size:.95rem;line-height:1.6">
        ‚ö†Ô∏è Note: this site uses <b>localStorage</b> (device-only). If you want the same edits on your phone, use <b>Export</b> on PC then <b>Import</b> on phone.
      </p>
    </div>
  </section>

  <!-- SYSTEM -->
  <section class="section" id="system">
    <div class="container">
      <h2>System Interface</h2>
      <p class="editable" data-key="system-desc" style="color:var(--muted)">
        Scroll to activate the 3D core. The background 3D scene reacts to your scroll position like a futuristic OS.
      </p>

      <div class="stage" id="stage3d">
        <div class="badges">
          <div class="badge"><b>üß† AI</b> Systems</div>
          <div class="badge"><b>‚öôÔ∏è Engineering</b> Logic</div>
          <div class="badge"><b>üìà Business</b> Impact</div>
        </div>
        <div class="scrollHint">‚¨áÔ∏è Scroll = 3D Motion</div>
        <div class="stageHUD">
          <div class="scan"></div>
          <div class="lines"></div>
        </div>
      </div>

      <div class="tags">
        <span class="tag editable" data-key="sys-tag-1">Prompt Systems</span>
        <span class="tag editable" data-key="sys-tag-2">Model Evaluation</span>
        <span class="tag editable" data-key="sys-tag-3">Optimization</span>
        <span class="tag editable" data-key="sys-tag-4">Communication</span>
        <span class="tag editable" data-key="sys-tag-5">Business Value</span>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section class="section" id="about">
    <div class="container">
      <h2>About</h2>
      <p class="editable" data-key="about-text">
        I‚Äôm a forward-thinking builder with a foundation in Generative AI, Machine Learning, Engineering fundamentals,
        HR Management, and Business Communication ‚Äî focused on modern, practical results.
      </p>

      <div class="projectsGrid" style="grid-template-columns:repeat(2,1fr)">
        <div class="projectCard">
          <div class="thumb">
            <img alt="About thumbnail 1" src="" data-thumb="about-1">
          </div>
          <div class="pBody">
            <div class="pTitle editable" data-key="about-card-1-title">üéØ What I do</div>
            <div class="pMeta editable" data-key="about-card-1-desc">Create clean UI, smart systems, and automated workflows that feel premium and perform fast.</div>
            <div class="pBtns" id="about1Admin" style="display:none">
              <label class="smallBtn">üñº Upload
                <input type="file" accept="image/*" data-about-upload="about-1" style="display:none">
              </label>
            </div>
          </div>
        </div>

        <div class="projectCard">
          <div class="thumb">
            <img alt="About thumbnail 2" src="" data-thumb="about-2">
          </div>
          <div class="pBody">
            <div class="pTitle editable" data-key="about-card-2-title">üß© What I value</div>
            <div class="pMeta editable" data-key="about-card-2-desc">Clarity, reliability, and execution ‚Äî building things that are beautiful and useful.</div>
            <div class="pBtns" id="about2Admin" style="display:none">
              <label class="smallBtn">üñº Upload
                <input type="file" accept="image/*" data-about-upload="about-2" style="display:none">
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SKILLS -->
  <section class="section" id="skills">
    <div class="container">
      <h2>Skills</h2>
      <p class="editable" data-key="skills-desc" style="color:var(--muted)">
        Add/remove skills anytime (Admin mode). Next: auto-sorting + skill level bars.
      </p>

      <div class="tags" id="skillsTags">
        <span class="tag editable" data-key="skill-1">Generative AI</span>
        <span class="tag editable" data-key="skill-2">Machine Learning</span>
        <span class="tag editable" data-key="skill-3">Engineering</span>
        <span class="tag editable" data-key="skill-4">Business Communication</span>
        <span class="tag editable" data-key="skill-5">HR Management</span>
        <span class="tag editable" data-key="skill-6">UI/UX</span>
      </div>

      <div class="actions" style="margin-top:16px; display:none" id="skillsAdminActions">
        <button class="btn" id="addSkill" type="button">‚ûï Add Skill</button>
        <button class="btn" id="removeSkill" type="button">‚ûñ Remove Last</button>
      </div>
    </div>
  </section>

  <!-- PROJECTS -->
  <section class="section" id="projects">
    <div class="container">
      <div style="display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div>
          <h2>Projects</h2>
          <p class="editable" data-key="projects-desc" style="color:var(--muted); margin-top:6px">
            Click any project for a premium modal preview. In Admin mode, you can edit text + upload images (saved locally).
          </p>
        </div>
        <div class="actions" id="projectsAdminActions" style="display:none;margin-top:0">
          <button class="btn" id="addProject" type="button">‚ûï Add Project</button>
          <button class="btn" id="removeProject" type="button">üóë Remove Last</button>
        </div>
      </div>

      <div class="projectsGrid" id="projectsGrid"></div>
    </div>
  </section>

  <!-- CONTACT -->
  <section class="section" id="contact">
    <div class="container">
      <h2>Contact</h2>
      <p class="editable" data-key="contact" style="color:var(--muted)">
        üìß Email: james.carpio@email.com<br>
        üíº LinkedIn: linkedin.com/in/james-carpio-b338b6337<br>
        üìç Location: Philippines
      </p>
      <p style="color:var(--muted); margin-top:14px; opacity:.9">
        ¬© 2026 James Carpio
      </p>
    </div>
  </section>
</main>

<!-- Modal -->
<div id="modal" onclick="if(event.target.id==='modal') closeModal()">
  <div class="modalBox" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="modalTop">
      <b id="mTitle">Project</b>
      <button class="modalClose" onclick="closeModal()" type="button">‚úï Close</button>
    </div>
    <div class="modalContent">
      <div class="modalImg"><img id="mImg" alt="Project image"></div>
      <div class="modalInfo">
        <div style="color:var(--muted);font-size:.95rem" id="mStack"></div>
        <div class="modalDesc" id="mDesc"></div>
        <div class="modalLinks" id="mLinks"></div>

        <div class="hr"></div>

        <div id="mAdmin" style="display:none">
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
            <label class="btn" style="display:inline-flex">
              üñº Upload Image
              <input type="file" id="mUpload" accept="image/*" style="display:none">
            </label>
            <button class="btn" id="editLinksBtn" type="button">üîß Edit Links</button>
          </div>
          <p style="color:var(--muted);margin-top:10px;font-size:.95rem;line-height:1.5">
            Tip: click the title/description in the project card to edit them (Admin ON).
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chat -->
<button id="chatBtn" title="Open AI Chat" type="button">ü§ñ</button>
<div id="chatBox">
  <div id="chatMessages"></div>
  <div class="row">
    <input id="chatInput" placeholder="Talk to my AI‚Ä¶" onkeydown="sendChat(event)">
    <button class="ctrlBtn" onclick="startVoice()" type="button">üé§</button>
  </div>
</div>

<!-- Three.js (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
/* =========================
   UTIL: Local Storage + helpers
========================= */
const LS = {
  get(k, d=null){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):d; }catch{return d;} },
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); },
  del(k){ localStorage.removeItem(k); }
};
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
const nowId = ()=> Math.random().toString(16).slice(2) + "-" + Date.now();

/* =========================
   Scroll progress + snap scroller
========================= */
const scroller = document.getElementById("scroller");
const progress = document.getElementById("progress");
function updateProgress(){
  const max = (scroller.scrollHeight - scroller.clientHeight) || 1;
  const p = (scroller.scrollTop / max) * 100;
  progress.style.width = p + "%";
}
scroller.addEventListener("scroll", updateProgress, {passive:true});
updateProgress();

/* =========================
   Admin: editable text + photo + admin tools
========================= */
let admin = false;

// ‚úÖ Change this password
const password = "123";

const editables = document.querySelectorAll(".editable");
const photo = document.getElementById("profilePhoto");
const photoLabel = document.getElementById("photoUploadLabel");
const photoInput = document.getElementById("photoUpload");
const toggleAdmin = document.getElementById("toggleAdmin");
const skillsAdminActions = document.getElementById("skillsAdminActions");
const projectsAdminActions = document.getElementById("projectsAdminActions");
const adminPill = document.getElementById("adminPill");
const about1Admin = document.getElementById("about1Admin");
const about2Admin = document.getElementById("about2Admin");

function setEditable(on){
  admin = on;

  editables.forEach(el => el.contentEditable = on);

  photoLabel.style.display = on ? "inline-flex" : "none";
  skillsAdminActions.style.display = on ? "flex" : "none";
  projectsAdminActions.style.display = on ? "flex" : "none";

  adminPill.style.display = on ? "flex" : "none";
  about1Admin.style.display = on ? "flex" : "none";
  about2Admin.style.display = on ? "flex" : "none";
}
setEditable(false);

function promptAdmin(){
  if(prompt("Admin password:") === password){
    setEditable(true);
    alert("Admin ON ‚úÖ");
  }else{
    alert("Wrong password ‚ùå");
  }
}
toggleAdmin.addEventListener("click", promptAdmin);

/* CTRL+SHIFT+A admin | CTRL+SHIFT+V exit */
document.addEventListener("keydown", e=>{
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==="a") promptAdmin();
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==="v"){
    setEditable(false);
    alert("Admin OFF ‚úÖ");
  }
});

/* Save + load editable keyed content */
function loadEditable(){
  editables.forEach(el=>{
    const key = el.getAttribute("data-key");
    if(!key) return;
    const saved = LS.get("txt:"+key, null);
    if(saved !== null) el.innerHTML = saved;
    el.addEventListener("input", ()=>{
      LS.set("txt:"+key, el.innerHTML);
    });
  });
}
loadEditable();

/* Photo persist */
const savedPhoto = LS.get("profile-photo", null);
if(savedPhoto){
  photo.src = savedPhoto;
  photo.style.display="block";
}
photoInput.onchange=()=>{
  const file = photoInput.files && photoInput.files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=()=>{
    LS.set("profile-photo", r.result);
    photo.src=r.result;
    photo.style.display="block";
  };
  r.readAsDataURL(file);
};

/* =========================
   Export / Import / Reset (solves ‚ÄúPC -> Phone‚Äù transfer)
========================= */
document.getElementById("exportBtn").addEventListener("click", ()=>{
  const dump = {};
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    dump[k] = localStorage.getItem(k); // keep raw string
  }
  const blob = new Blob([JSON.stringify({version:1, ts:Date.now(), data:dump}, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "portfolio-backup.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
});

document.getElementById("adminImport").addEventListener("change", (e)=>{
  const file = e.target.files && e.target.files[0];
  if(!file) return;
  const r = new FileReader();
  r.onload = ()=>{
    try{
      const obj = JSON.parse(r.result);
      const data = obj && obj.data ? obj.data : null;
      if(!data) throw new Error("Invalid backup");
      Object.keys(data).forEach(k=>{
        localStorage.setItem(k, data[k]);
      });
      alert("Import success ‚úÖ Reloading‚Ä¶");
      location.reload();
    }catch(err){
      alert("Import failed ‚ùå");
    }
  };
  r.readAsText(file);
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  if(!confirm("Reset ALL saved edits/images on this device?")) return;
  localStorage.clear();
  alert("Reset done ‚úÖ Reloading‚Ä¶");
  location.reload();
});

/* =========================
   Skills add/remove (admin)
========================= */
const skillsTags = document.getElementById("skillsTags");
document.getElementById("addSkill").addEventListener("click", ()=>{
  if(!admin) return;
  const span = document.createElement("span");
  span.className = "tag editable";
  span.contentEditable = true;
  span.textContent = "New Skill";
  const key = "skill-custom-" + Date.now();
  span.setAttribute("data-key", key);
  skillsTags.appendChild(span);
  span.addEventListener("input", ()=> LS.set("txt:"+key, span.innerHTML));
});
document.getElementById("removeSkill").addEventListener("click", ()=>{
  if(!admin) return;
  const tags = skillsTags.querySelectorAll(".tag");
  if(tags.length <= 0) return;
  const last = tags[tags.length-1];
  const key = last.getAttribute("data-key");
  if(key) localStorage.removeItem("txt:"+key);
  last.remove();
});

/* =========================
   Project Gallery + Modal + Image Upload (local)
========================= */
const placeholderSVG = (t1,t2)=>`data:image/svg+xml;charset=utf-8,` + encodeURIComponent(`
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#071733"/>
      <stop offset="0.6" stop-color="#0b1d42"/>
      <stop offset="1" stop-color="#050b18"/>
    </linearGradient>
    <radialGradient id="r" cx="30%" cy="30%" r="70%">
      <stop offset="0" stop-color="rgba(77,163,255,0.35)"/>
      <stop offset="1" stop-color="rgba(127,92,255,0)"/>
    </radialGradient>
  </defs>
  <rect width="100%" height="100%" fill="url(#g)"/>
  <rect width="100%" height="100%" fill="url(#r)"/>
  <g opacity="0.9">
    <circle cx="220" cy="220" r="160" fill="rgba(77,163,255,0.12)"/>
    <circle cx="980" cy="480" r="220" fill="rgba(127,92,255,0.10)"/>
    <path d="M120 560 C 380 350, 520 720, 860 520" stroke="rgba(77,163,255,0.35)" stroke-width="4" fill="none"/>
    <path d="M220 120 C 520 220, 760 80, 1080 240" stroke="rgba(255,255,255,0.18)" stroke-width="3" fill="none"/>
  </g>
  <text x="70" y="610" font-family="system-ui,Segoe UI" font-size="46" fill="rgba(234,242,255,0.92)" font-weight="700">${t1}</text>
  <text x="70" y="660" font-family="system-ui,Segoe UI" font-size="24" fill="rgba(234,242,255,0.70)">${t2}</text>
</svg>
`);

const defaultProjects = [
  {
    id:"p1",
    title:"AI Workflow System",
    desc:"A clean GenAI workflow: prompt templates, evaluation loop, and automation for consistent results.",
    stack:["GenAI","Prompting","Evaluation","Automation"],
    link:"#",
    repo:"#",
    thumb: placeholderSVG("AI Workflow System","GenAI ‚Ä¢ Evaluation ‚Ä¢ Automation")
  },
  {
    id:"p2",
    title:"Engineering Optimization Mini-Tool",
    desc:"A practical engineering-focused mini tool that models, computes, and optimizes outcomes with clear UX.",
    stack:["Modeling","Optimization","Engineering Math"],
    link:"#",
    repo:"#",
    thumb: placeholderSVG("Engineering Mini-Tool","Modeling ‚Ä¢ Optimization ‚Ä¢ Systems")
  },
  {
    id:"p3",
    title:"Business Communication Dashboard",
    desc:"A dashboard-style portfolio module to communicate insights clearly: structured sections, metrics, and storytelling.",
    stack:["Communication","Presentation","UX"],
    link:"#",
    repo:"#",
    thumb: placeholderSVG("Business Dashboard","Clarity ‚Ä¢ Storytelling ‚Ä¢ UX")
  }
];

let projects = LS.get("projects", null) || defaultProjects;
LS.set("projects", projects);

const grid = document.getElementById("projectsGrid");

function renderProjects(){
  grid.innerHTML = "";
  projects.forEach(p=>{
    const tKey = `proj:${p.id}:title`;
    const dKey = `proj:${p.id}:desc`;
    const savedT = LS.get("txt:"+tKey, null);
    const savedD = LS.get("txt:"+dKey, null);

    const card = document.createElement("div");
    card.className = "projectCard";

    const thumb = document.createElement("div");
    thumb.className = "thumb";
    const img = document.createElement("img");
    img.alt = p.title;
    img.loading = "lazy";
    img.decoding = "async";
    img.src = LS.get("img:"+p.id, null) || p.thumb;
    thumb.appendChild(img);

    const body = document.createElement("div");
    body.className = "pBody";

    const title = document.createElement("div");
    title.className = "pTitle editable";
    title.setAttribute("data-key", tKey);
    title.innerHTML = savedT ?? p.title;

    const meta = document.createElement("div");
    meta.className = "pMeta editable";
    meta.setAttribute("data-key", dKey);
    meta.innerHTML = savedD ?? p.desc;

    const btns = document.createElement("div");
    btns.className = "pBtns";

    const view = document.createElement("button");
    view.className = "smallBtn";
    view.textContent = "üîé Preview";
    view.type = "button";
    view.onclick = ()=> openModal(p.id);

    const link = document.createElement("a");
    link.className = "smallBtn";
    link.textContent = "üåê Link";
    link.href = p.link || "#";
    link.target = "_blank";
    link.rel = "noopener";

    const repo = document.createElement("a");
    repo.className = "smallBtn";
    repo.textContent = "üíª Repo";
    repo.href = p.repo || "#";
    repo.target = "_blank";
    repo.rel = "noopener";

    btns.appendChild(view);
    btns.appendChild(link);
    btns.appendChild(repo);

    body.appendChild(title);
    body.appendChild(meta);
    body.appendChild(btns);

    card.appendChild(thumb);
    card.appendChild(body);
    grid.appendChild(card);
  });

  bindEditableSaves();
  setEditable(admin);
}

function bindEditableSaves(){
  document.querySelectorAll(".editable[data-key]").forEach(el=>{
    if(el.__bound) return;
    el.__bound = true;

    const key = el.getAttribute("data-key");
    const saved = LS.get("txt:"+key, null);
    if(saved !== null) el.innerHTML = saved;

    el.addEventListener("input", ()=> LS.set("txt:"+key, el.innerHTML));
  });
}
bindEditableSaves();
renderProjects();

/* Admin: add/remove projects */
document.getElementById("addProject").addEventListener("click", ()=>{
  if(!admin) return;
  const id = "p-" + nowId();
  projects.push({
    id,
    title:"New Project",
    desc:"Describe your project here‚Ä¶",
    stack:["Stack1","Stack2"],
    link:"#",
    repo:"#",
    thumb: placeholderSVG("New Project","Click Preview to edit")
  });
  LS.set("projects", projects);
  renderProjects();
});

document.getElementById("removeProject").addEventListener("click", ()=>{
  if(!admin) return;
  if(projects.length===0) return;
  const p = projects[projects.length-1];
  if(!confirm(`Remove "${p.title}"?`)) return;

  // cleanup
  LS.del("img:"+p.id);
  LS.del("txt:proj:"+p.id+":title");
  LS.del("txt:proj:"+p.id+":desc");
  LS.del("projmeta:"+p.id);

  projects.pop();
  LS.set("projects", projects);
  renderProjects();
});

/* ===== Modal logic ===== */
const modal = document.getElementById("modal");
const mTitle = document.getElementById("mTitle");
const mImg = document.getElementById("mImg");
const mDesc = document.getElementById("mDesc");
const mStack = document.getElementById("mStack");
const mLinks = document.getElementById("mLinks");
const mAdmin = document.getElementById("mAdmin");
const mUpload = document.getElementById("mUpload");
const editLinksBtn = document.getElementById("editLinksBtn");

let activeProjectId = null;

function openModal(pid){
  activeProjectId = pid;
  const p = projects.find(x=>x.id===pid);
  if(!p) return;

  const tKey = `proj:${p.id}:title`;
  const dKey = `proj:${p.id}:desc`;
  const metaKey = "projmeta:"+p.id;
  const meta = LS.get(metaKey, null) || { link:p.link||"#", repo:p.repo||"#", stack:p.stack||[] };

  mTitle.textContent = (LS.get("txt:"+tKey,null) ?? p.title).replace(/<[^>]*>/g,"");
  mDesc.innerHTML = LS.get("txt:"+dKey,null) ?? p.desc;

  const imgSrc = LS.get("img:"+p.id, null) || p.thumb;
  mImg.src = imgSrc;

  const stack = Array.isArray(meta.stack) ? meta.stack : (p.stack||[]);
  mStack.textContent = "Stack: " + stack.join(" ‚Ä¢ ");

  mLinks.innerHTML = "";
  const a1 = document.createElement("a");
  a1.className="smallBtn";
  a1.textContent="üåê Link";
  a1.href=meta.link || "#";
  a1.target="_blank";
  a1.rel="noopener";

  const a2 = document.createElement("a");
  a2.className="smallBtn";
  a2.textContent="üíª Repo";
  a2.href=meta.repo || "#";
  a2.target="_blank";
  a2.rel="noopener";

  mLinks.appendChild(a1);
  mLinks.appendChild(a2);

  mAdmin.style.display = admin ? "block" : "none";
  modal.classList.add("on");
}
function closeModal(){
  modal.classList.remove("on");
  activeProjectId = null;
}
window.closeModal = closeModal;

/* Modal image upload */
mUpload.addEventListener("change", ()=>{
  if(!admin) return;
  const file = mUpload.files && mUpload.files[0];
  if(!file || !activeProjectId) return;

  const r = new FileReader();
  r.onload = ()=>{
    LS.set("img:"+activeProjectId, r.result);
    mImg.src = r.result;
    renderProjects();
  };
  r.readAsDataURL(file);
});

/* Modal edit links + stack */
editLinksBtn.addEventListener("click", ()=>{
  if(!admin || !activeProjectId) return;
  const p = projects.find(x=>x.id===activeProjectId);
  if(!p) return;

  const metaKey = "projmeta:"+p.id;
  const meta = LS.get(metaKey, null) || { link:p.link||"#", repo:p.repo||"#", stack:p.stack||[] };

  const link = prompt("Project Link (URL):", meta.link || "#");
  if(link === null) return;
  const repo = prompt("Repo Link (URL):", meta.repo || "#");
  if(repo === null) return;
  const stackStr = prompt("Stack (comma-separated):", (meta.stack||[]).join(", "));
  if(stackStr === null) return;

  meta.link = link.trim() || "#";
  meta.repo = repo.trim() || "#";
  meta.stack = stackStr.split(",").map(s=>s.trim()).filter(Boolean);

  LS.set(metaKey, meta);
  openModal(p.id); // refresh modal
  renderProjects(); // refresh cards (links in card use p.link/p.repo, but preview uses meta; keeping cards simple)
});

/* =========================
   About thumbnails (editable + upload)
========================= */
function setAboutThumb(key, url){
  const el = document.querySelector(`img[data-thumb="${key}"]`);
  if(!el) return;
  el.loading = "lazy";
  el.decoding = "async";
  el.src = url;
}
const about1Saved = LS.get("img:about-1", null);
const about2Saved = LS.get("img:about-2", null);
setAboutThumb("about-1", about1Saved || placeholderSVG("What I Do","Systems ‚Ä¢ UX ‚Ä¢ Automation"));
setAboutThumb("about-2", about2Saved || placeholderSVG("What I Value","Clarity ‚Ä¢ Reliability ‚Ä¢ Execution"));

document.querySelectorAll('input[data-about-upload]').forEach(inp=>{
  inp.addEventListener("change", ()=>{
    if(!admin) return;
    const k = inp.getAttribute("data-about-upload");
    const file = inp.files && inp.files[0];
    if(!k || !file) return;
    const r = new FileReader();
    r.onload = ()=>{
      LS.set("img:"+k, r.result);
      setAboutThumb(k, r.result);
    };
    r.readAsDataURL(file);
  });
});

/* =========================
   THREE.JS: background reacting to scroll
========================= */
const bg = document.getElementById("bg3d");
let renderer, scene, camera, coreGroup, particles;
let t = 0;
let scrollN = 0;

function init3D(){
  if(typeof THREE === "undefined") return;

  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 200);
  camera.position.set(0, 0.1, 6.4);

  renderer = new THREE.WebGLRenderer({alpha:true, antialias:true, powerPreference:"high-performance"});
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  bg.appendChild(renderer.domElement);

  const amb = new THREE.AmbientLight(0xffffff, 0.45);
  scene.add(amb);

  const key = new THREE.PointLight(0x4da3ff, 1.2, 60);
  key.position.set(2.8, 1.6, 5.4);
  scene.add(key);

  const rim = new THREE.PointLight(0x7f5cff, 0.9, 60);
  rim.position.set(-2.8, -1.2, 4.2);
  scene.add(rim);

  coreGroup = new THREE.Group();
  scene.add(coreGroup);

  const sphereGeo = new THREE.IcosahedronGeometry(1.05, 5);
  const sphereMat = new THREE.MeshPhysicalMaterial({
    color: new THREE.Color(0x0a1b39),
    emissive: new THREE.Color(0x0b2a55),
    emissiveIntensity: 0.45,
    metalness: 0.35,
    roughness: 0.25,
    transmission: 0.10,
    thickness: 0.8,
    clearcoat: 0.8,
    clearcoatRoughness: 0.15
  });
  const core = new THREE.Mesh(sphereGeo, sphereMat);
  coreGroup.add(core);

  const ringGeo = new THREE.TorusGeometry(1.55, 0.04, 16, 220);
  const ringMat1 = new THREE.MeshStandardMaterial({color:0x4da3ff, emissive:0x2a74d8, emissiveIntensity:0.55, metalness:0.6, roughness:0.25});
  const ringMat2 = new THREE.MeshStandardMaterial({color:0x7f5cff, emissive:0x4b2bd8, emissiveIntensity:0.55, metalness:0.6, roughness:0.25});
  const ringMat3 = new THREE.MeshStandardMaterial({color:0xffffff, emissive:0x4da3ff, emissiveIntensity:0.25, metalness:0.5, roughness:0.25});

  const ring1 = new THREE.Mesh(ringGeo, ringMat1);
  const ring2 = new THREE.Mesh(ringGeo, ringMat2);
  const ring3 = new THREE.Mesh(new THREE.TorusGeometry(1.85, 0.03, 16, 240), ringMat3);

  ring2.rotation.x = Math.PI * 0.55;
  ring3.rotation.y = Math.PI * 0.55;
  coreGroup.add(ring1, ring2, ring3);

  const nodeGeo = new THREE.SphereGeometry(0.06, 18, 18);
  const nodeMat = new THREE.MeshStandardMaterial({color:0xeaf2ff, emissive:0x4da3ff, emissiveIntensity:0.4, metalness:0.2, roughness:0.2});
  const nodes = new THREE.Group();
  for(let i=0;i<14;i++){
    const n = new THREE.Mesh(nodeGeo, nodeMat);
    const a = (i/14) * Math.PI * 2;
    const r = 2.25 + (i%3)*0.08;
    n.position.set(Math.cos(a)*r, Math.sin(a*1.2)*0.22, Math.sin(a)*r*0.12);
    nodes.add(n);
  }
  coreGroup.add(nodes);

  const pCount = 1400;
  const pos = new Float32Array(pCount*3);
  for(let i=0;i<pCount;i++){
    const R = 14 * Math.random();
    const a = Math.random()*Math.PI*2;
    const y = (Math.random()-0.5)*7.5;
    pos[i*3+0] = Math.cos(a)*R;
    pos[i*3+1] = y;
    pos[i*3+2] = Math.sin(a)*R;
  }
  const pGeo = new THREE.BufferGeometry();
  pGeo.setAttribute("position", new THREE.BufferAttribute(pos,3));
  const pMat = new THREE.PointsMaterial({color:0xeaf2ff,size:0.012,transparent:true,opacity:0.45});
  particles = new THREE.Points(pGeo, pMat);
  scene.add(particles);

  coreGroup.rotation.set(0.2, 0.2, 0);

  window.addEventListener("resize", onResize, {passive:true});
  requestAnimationFrame(animate);
}

function onResize(){
  if(!renderer || !camera) return;
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate(){
  if(!renderer || !scene || !camera) return;

  t += 0.008;
  const max = (scroller.scrollHeight - scroller.clientHeight) || 1;
  scrollN = clamp(scroller.scrollTop / max, 0, 1);

  const pulse = 0.25 + 0.75 * Math.sin(t*1.2 + scrollN*3.0) * 0.5 + 0.25;
  const charge = clamp((scrollN*1.25), 0, 1);

  coreGroup.rotation.y = t*0.8 + scrollN*2.8;
  coreGroup.rotation.x = 0.25 + Math.sin(t*0.6)*0.08 + scrollN*0.35;
  coreGroup.rotation.z = Math.sin(t*0.45)*0.06;

  camera.position.z = 6.4 - charge*1.15;
  camera.position.x = Math.sin(t*0.35)*0.22 + (scrollN-0.5)*0.22;
  camera.position.y = 0.10 + Math.cos(t*0.30)*0.10 - (scrollN-0.5)*0.10;
  camera.lookAt(0, 0, 0);

  const core = coreGroup.children[0];
  if(core && core.material){
    core.material.emissiveIntensity = 0.35 + charge*0.55 + pulse*0.10;
  }

  const ring1 = coreGroup.children[1];
  const ring2 = coreGroup.children[2];
  const ring3 = coreGroup.children[3];
  if(ring1) ring1.rotation.z += 0.012 + charge*0.01;
  if(ring2) ring2.rotation.z -= 0.010 + charge*0.012;
  if(ring3) ring3.rotation.x += 0.009 + charge*0.01;

  if(particles){
    particles.rotation.y = t*0.08 + scrollN*0.6;
    particles.rotation.x = t*0.03;
    particles.material.opacity = 0.22 + charge*0.28;
  }

  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}
init3D();

/* =========================
   Chat
========================= */
const chatBox=document.getElementById("chatBox");
const chatMessages=document.getElementById("chatMessages");
const chatInput=document.getElementById("chatInput");

document.getElementById("chatBtn").onclick=()=>{
  chatBox.style.display = chatBox.style.display==="flex" ? "none" : "flex";
};

function addMsg(s,t,c){
  const d=document.createElement("div");
  d.className=c;
  d.innerHTML=`<b>${s}:</b> ${t}`;
  chatMessages.appendChild(d);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function sendChat(e){
  if(e.key!=="Enter")return;
  const msg=e.target.value.trim();
  if(!msg)return;
  addMsg("You",msg,"msg-user");
  e.target.value="";
  setTimeout(()=>{
    const r="Hi! I‚Äôm James Carpio‚Äôs AI. You can reach James via email or LinkedIn in the Contact section. üöÄ";
    addMsg("AI",r,"msg-ai");
    if("speechSynthesis" in window){
      speechSynthesis.cancel();
      speechSynthesis.speak(new SpeechSynthesisUtterance(r));
    }
  },300);
}
function startVoice(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){
    addMsg("AI","Voice input isn‚Äôt supported here. Try Chrome desktop üé§","msg-ai");
    return;
  }
  const r=new SR();
  r.lang="en-US";
  r.start();
  r.onresult=e=>{
    chatInput.value=e.results[0][0].transcript;
    sendChat({key:"Enter",target:chatInput});
  };
}

/* Stage feedback on scroll */
const stage = document.getElementById("stage3d");
function updateStage(){
  const rect = stage.getBoundingClientRect();
  const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
  const center = rect.top + rect.height/2;
  const dist = (vh/2 - center);
  const norm = clamp((dist/(vh/2))*-1, -1, 1);
  const intensity = 1 - Math.abs(norm);
  stage.style.boxShadow = `0 0 ${150 + intensity*200}px rgba(77,163,255,${0.12 + intensity*0.24})`;
  stage.style.borderColor = `rgba(77,163,255,${0.16 + intensity*0.40})`;
}
scroller.addEventListener("scroll", updateStage, {passive:true});
updateStage();
</script>
</body>
</html>
